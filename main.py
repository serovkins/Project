import telebot
import os
import random
from yandex_cloud_ml_sdk import YCloudML
from telebot import types

bot = telebot.TeleBot('8186093657:AAE2OBkFSm81v8SMM8YRz0LPmksxxz5y3qw')

# Хранилище состояния пользователей
user_data = {}

# Конфигурация путей
BASE_DIR = os.path.dirname(os.path.abspath(__file__))
MEDIA_DIR = os.path.join(BASE_DIR, 'media')

SENSITIVE_KEYWORDS = ['крым', 'присоединение', 'политика', 'война', 'конфликт']
NEUTRAL_RESPONSES = [
    "Этот вопрос требует детального изучения исторических источников.",
    "Тема требует комплексного анализа и экспертного мнения.",
    "Рекомендую обратиться к академическим исследованиям по этой теме.",
    "Для ответа на этот вопрос необходимо учитывать разные точки зрения."
]

routes = {
    'vitebsk': {
        'name': 'Витебский вокзал',
        'media': {'type': 'image', 'file': 'Vitebsk.png'},
        'points': [
            {'name': 'Витебский вокзал в Санкт-Петербурге',
             'desc': 'Первый железнодорожный вокзал в России, открытый 30 октября (11 ноября) 1837 года для Царскосельской железной дороги. Первое здание было деревянным, а современное здание в стиле модерн построено в 1904 году по проекту архитектора Станислава Бржозовского. Вокзал стал важным транспортным узлом и символом развития железных дорог в стране.',
             'media': {'type': 'video', 'file': 'point1.mp4'}},

            {'name': 'Франц Антон фон Герстнер',
             'desc': 'Австрийский инженер и предприниматель, сыгравший ключевую роль в строительстве первой железной дороги в России (Царскосельской), которая связала Санкт-Петербург с Царским Селом. Именно при его руководстве был открыт Витебский вокзал (тогда — Царскосельский) в 1837 году. Герстнер убедил Николая I в необходимости развития железных дорог и лично руководил проектом, став пионером российского железнодорожного транспорта.',
             'media': {'type': 'image', 'file': 'point2.png'}},

            {'name': 'Бронзовый памятник А. С. Грибоедов',
             'desc': 'Установлен в 1959 году на Пионерской площади перед Театром юного зрителя. Русский поэт, драматург, дипломат, известен своей пьесой «Горе от ума», которую до сих пор ставят в театрах. Александр Сергеевич будто бы внимательно смотрит вдаль на Адмиралтейство. Памятник является образцом классического реализма.',
             'media': {'type': 'image', 'file': 'point3.png'}},

            {'name': 'Театр юных зрителей имени А. А. Брянцева',
             'desc': 'Один из старейших театров России, основанный в 1922 году. В репертуаре театра — более полусотни спектаклей для зрителей всех возрастов. На трёх сценах (Большой, Малой и Новой) идут традиционные и экспериментальные постановки по русской и зарубежной классике, а также драматургии современных авторов.',
             'media': {'type': 'video', 'file': 'point4.mp4'}},

            {'name': '«Пять углов»',
             'desc': 'Неофициальное название перекрёстка в Санкт-Петербурге, образованного пересечением Загородного проспекта с улицами Разъезжей, Рубинштейна и Ломоносова. Этот перекрёсток появился ещё во второй половине XVIII века. Архитектурной доминантой перекрёстка является доходный дом с башенкой, построенный по проекту архитектора А. Лишневского в начале XX века.',
             'media': {'type': 'video', 'file': 'point5.mp4'}},

            {'name': 'Мост Ломоносова',
             'desc': 'Красивый пешеходный мост через реку Фонтанку, расположенный в центре Санкт-Петербурга. Он был построен в 19 веке и с тех пор стал излюбленным местом для фотографий и прогулок.',
             'media': {'type': 'video', 'file': 'point6.mp4'}},

            {'name': 'Памятник Михаилу Васильевичу Ломоносову',
             'desc': 'Cоздал скульптор и академик Пармен Петрович Забелло в 1892 году.',
             'media': {'type': 'video', 'file': 'point7.mp4'}},

            {'name': 'Александринский театр',
             'desc': 'Oдин из старейших театров в России, основанный императрицей Елизаветой Петровной в 1756 году. В репертуаре театра не только классические постановки, но и современные интерпретации известных литературных произведений. Актеры мастерски передают характеры своих героев, а сценография и музыка добавляют особую магию.',
             'media': {'type': 'video', 'file': 'point8.mp4'}},

            {'name': 'Аничков дворец',
             'desc': 'Один из императорских дворцов Санкт-Петербурга, расположенный у Аничкова моста на набережной реки Фонтанки. Это старейшее из сохранившихся зданий на Невском проспекте, построенное в стиле барокко. За свой долгий век дворец сменил множество хозяев. Интерьеры дворца неоднократно подвергались переделкам в связи с желаниями новых владельцев.',
             'media': {'type': 'video', 'file': 'point9.mp4'}},

            {'name': 'Памятник «Екатерина II»',
             'desc': 'Был создан скульптором Михаилом Микешиным и установлен в честь столетия восшествия императрицы на российский престол. Памятник изображает Екатерину II, стоящей на пьедестале, а вокруг нее изображены ее соратники и фавориты.',
             'media': {'type': 'video', 'file': 'point10.mp4'}},

            {'name': 'Невский проспект',
             'desc': 'Главная и старейшая магистраль Санкт-Петербурга, заложенная в 1710 году как дорога от Адмиралтейства к Александро-Невской лавре. Окончательно сформировался к 1730-м годам, став центральной артерией города с дворцами, храмами и торговыми рядами.',
             'media': {'type': 'video', 'file': 'point11.mp4'}},

            {'name': 'Кот Елисей',
             'desc': 'Бронзовая скульптура, установленная на Малой Садовой улице, 8, в Санкт-Петербурге 25 января 2000 года в рамках проекта по оживлению исторического центра города. Фигура кота, созданная скульптором Владимиром Петровичевым, стала частью парной композиции вместе с кошкой Василисой на противоположной стороне улицы.  Эти скульптуры – дань памяти кошкам, спасшим блокадный Ленинград от крыс, а также популярный современный символ города, привлекающий туристов на удачу.',
             'media': {'type': 'image', 'file': 'point12.png'}},

            {'name': 'Российский этнографический музей',
             'desc': 'Уникальное хранилище традиций, обычаев и быта различных этнических групп, населяющих Россию. Он был основан как этнографический отдел Русского музея императора Александра III в 1902 году.  Здесь можно увидеть национальные костюмы, предметы домашнего обихода, орудия труда, музыкальные инструменты и многое другое.',
             'media': {'type': 'video', 'file': 'point13.mp4'}},

            {'name': 'Михайловский дворец',
             'desc': 'Выдающийся памятник архитектуры русского ампира, построенный в 1819–1825 годах по проекту Карла Росси для великого князя Михаила Павловича, младшего брата императора Александра I. Дворец стал центром ансамбля Михайловской площади (ныне площадь Искусств) и образцом гармоничной градостроительной композиции. В 1895 году здание было выкуплено в казну и передано под Русский музей императора Александра III (ныне — Государственный Русский музей), став первым в России государственным музеем национального искусства. Сегодня дворец хранит крупнейшую коллекцию русского искусства — от древних икон до авангарда, а его парадные интерьеры работы Росси считаются шедеврами классицизма.',
             'media': {'type': 'video', 'file': 'point14.mp4'}}
            ,
            {'name': 'Спас на Крови (официально — Храм Воскресения Христова)',
             'desc': 'Один из самых узнаваемых символов Санкт-Петербурга, построенный на месте убийства императора Александра II 1 марта 1881 года. Строительство велось с 1883 по 1907 год по проекту архитекторов Альфреда Парланда и архимандрита Игнатия (Малышева) в русском стиле, вдохновлённом собором Василия Блаженного в Москве. Храм знаменит своей мозаичной коллекцией (площадь украшений превышает 7 000 м²), а также сложной историей: в советское время его хотели снести, но сохранили, а после реставрации 1997 года он стал музеем и популярным туристическим объектом.',
             'media': {'type': 'video', 'file': 'point15.mp4'}},

            {'name': 'Михайловский сад',
             'desc': 'Один из самых живописных парков в центре Санкт-Петербурга, созданный в XVIII–XIX веках и сочетающий черты регулярного и пейзажного стилей. Изначально он входил в ансамбль Летнего сада и принадлежал императорской семье, а при Павле I стал частью Михайловского замка.',
             'media': {'type': 'video', 'file': 'point16.mp4'}},

            {'name': ' Дуб черешчатый',
             'desc': 'Достопримечательность Михайловского сада в Санкт-Петербурге. Этому дубу почти 300 лет, и он является одним из старейших деревьев в городе.',
             'media': {'type': 'image', 'file': 'point17.png'}},

            {'name': 'Михайловский замок',
             'desc': 'Императорская резиденция в Санкт-Петербурге, построенная по приказу Павла I в 1797–1801 годах как укреплённый дворец в стиле романтического классицизма. Архитектурный проект разрабатывали Винченцо Бренна и Василий Баженов, а сам император активно участвовал в создании облика замка. Замок получил название в честь архангела Михаила, небесного покровителя Романовых, но Павел I прожил в нём лишь 40 дней — в 1801 году он был убит заговорщиками в собственной спальне. В XIX веке здание передали Инженерному училищу (отсюда второе название — Инженерный замок), а с 1991 года оно стало частью Русского музея. Сегодня это одна из самых загадочных и мистических достопримечательностей Петербурга.',
             'media': {'type': 'image', 'file': 'point18.png'}},

            {'name': 'Летний сад',
             'desc': 'Cтарейший дворцово-парковый ансамбль Санкт-Петербурга, памятник садово-паркового искусства XVIII века. Он был заложен по повелению Петра I в 1704 году и изначально был регулярным. Сад занимает отдельный одноимённый остров, омываемый реками Невой, Фонтанкой, Мойкой и Лебяжьей канавкой. В саду представлены мраморные скульптуры итальянских мастеров конца XVII — начала XVIII вв.. В 1710 году в саду насчитывалось около 30 статуй и бюстов, к 1728 году их количество достигло более 100. «Порфировая ваза» — это жанровая скульптура, расположенная в Летнем саду в Санкт-Петербурге. Она была подарена шведским королем Карлом XIV русскому императору Николаю I в знак доброй воли после длительных и многочисленных войн между Швецией и Россией.',
             'media': {'type': 'image', 'file': 'point19.png'}},

            {'name': 'Марсово поле',
             'desc': 'Одна из крупнейших и старейших исторических площадей Санкт-Петербурга, основанная в начале XVIII века как место военных парадов и народных гуляний. При Петре I здесь находился «Потешный луг», а позднее — «Царицын луг», где проходили праздники в честь побед Российской империи. Современное название закрепилось в 1805 году по аналогии с античным «Полем Марса» — в духе классицистической традиции. В XX веке (1917–1919) поле стало местом массовых захоронений жертв революции, а в 1957 году здесь зажгли первый в СССР Вечный огонь в память о погибших. Сегодня это мемориально-парковая зона с монументальным гранитным комплексом, популярное место для прогулок и исторических экскурсий.',
             'media': {'type': 'video', 'file': 'point20.mp4'}},

            {'name': 'Зимний дворец',
             'desc': 'главная императорская резиденция в Санкт-Петербурге, построенная в 1754–1762 годах по проекту Бартоломео Растрелли в стиле пышного елизаветинского барокко. Дворец стал символом могущества Российской империи и служил зимней резиденцией русских монархов от Екатерины II до Николая II. Здание сильно пострадало во время пожара 1837 года, но было восстановлено под руководством Василия Стасова и Александра Брюллова с сохранением внешнего облика. В 1917 году дворец стал ключевой точкой Октябрьской революции — его штурм ознаменовал падение Временного правительства. С 1922 года Зимний дворец является частью Государственного Эрмитажа — одного из крупнейших музеев мира, хранящего шедевры искусства от античности до современности. Его фасады, парадные залы и роскошные интерьеры остаются визитной карточкой Петербурга.',
             'media': {'type': 'video', 'file': 'point21.mp4'}},

            {'name': 'Адмиралтейство',
             'desc': 'Один из главных архитектурных символов Санкт-Петербурга, заложенный 5 ноября 1704 года по указу Петра I как верфь и центр строительства российского флота. Первое здание было деревянным, но к 1738 году его перестроили в камне под руководством архитектора Ивана Коробова, а современный облик в стиле классицизма создал Андреян Захаров в 1806–1823 годах. Главная особенность — золочёный шпиль с корабликом-флюгером (высота — 72,5 метра), ставший эмблемой города. На шпиле находится один из первых громоотводов России, установленный в 1783 году. С XVIII века Адмиралтейство было не только верфью, но и центром военно-морского управления, а с 2012 года здесь размещается Главный штаб ВМФ России. Здание входит в ансамбль Дворцовой площади и Невы, формируя «золотой треугольник» Петербурга вместе с Зимним дворцом и Исаакиевским собором.',
             'media': {'type': 'video', 'file': 'point22.mp4'}},

            {'name': 'Сад Зимнего дворца',
             'desc': 'Небольшой сад, созданный в 1896–1897 годах по проекту архитектора Григория Люцедарского для императора Николая II. Он расположен с южной стороны Зимнего дворца, между его фасадом и Адмиралтейством, и изначально предназначался для приватного отдыха царской семьи.',
             'media': {'type': 'video', 'file': 'point23.mp4'}},
        ]
    },
    'finland': {
        'name': 'Финляндский вокзал',
        'media': {'type': 'image', 'file': 'Finland.png'},
        'points': [
            {'name': 'причал Арсенальная набережная',
             'desc': 'Судоходный причал, расположенный на Арсенальной набережной Большой Невки (правый берег), практически напротив Финляндского вокзала. Используется для стоянки и обслуживания речных судов (прогулочных теплоходов, водных такси), особенно в навигационный период. Отсюда открываются виды на Финляндский мост, вокзал и противоположный берег.',
             'media': {'type': 'image', 'file': 'point24.png'}},

            {'name': 'Пироговская набережная',
             'desc': 'Живописная набережная на правом (северном) берегу Большой Невки, протянувшаяся от Гренадерского моста до Ушаковской набережной. Известна великолепными видами на Неву, исторические здания (особенно на противоположном берегу - Смольный собор) и ансамбль Таврического дворца. Более "камерная" и зеленая, чем центральные набережные Невы. Названа в честь хирурга Н. И. Пирогова.',
             'media': {'type': 'image', 'file': 'point25.png'}},

            {'name': 'Петроградская набережная',
             'desc': 'Набережная на северном берегу Большой Невки (Петроградская сторона), простирающаяся от Петровского моста до Малой Невки. Знаменита уникальным памятником архитектуры - Домиком Петра I (первая постройка в городе), крейсером "Аврора" (постоянно пришвартован у Нахимовского училища) и величественным зданием Нахимовского военно-морского училища. Отличные виды на Стрелку Васильевского острова.',
             'media': {'type': 'image', 'file': 'point26.png'}},

            {'name': 'Петровская набережная',
             'desc': 'Одна из старейших набережных города, расположенная на правом (северном) берегу Невы, на Петроградской стороне. Начинается у Троицкой площади (где стоял первый порт) и тянется вдоль Невы до Петровского моста. Главные достопримечательности: памятник "Царь-плотник" (Петр I), грандиозный особняк Матильды Кшесинской (ныне Музей политической истории), необычный "Китайский" домик Лейхтенбергского, скульптуры Ши-Цза (мифические львы-лягушки) у спуска к воде. Виды на Зимний дворец и Эрмитаж.',
             'media': {'type': 'image', 'file': 'point27.png'}},

            {'name': 'Петровская набережная',
             'desc': 'Одна из старейших набережных города, расположенная на правом (северном) берегу Невы, на Петроградской стороне. Начинается у Троицкой площади (где стоял первый порт) и тянется вдоль Невы до Петровского моста. Главные достопримечательности: памятник "Царь-плотник" (Петр I), грандиозный особняк Матильды Кшесинской (ныне Музей политической истории), необычный "Китайский" домик Лейхтенбергского, скульптуры Ши-Цза (мифические львы-лягушки) у спуска к воде. Виды на Зимний дворец и Эрмитаж.',
             'media': {'type': 'image', 'file': 'point28.png'}},

            {'name': 'Каменноостровский проспект',
             'desc': 'Одна из красивейших и старейших магистралей Петроградской стороны, проложенная в XVIII веке. Простирается от Троицкой площади до Ушаковского моста. Архитектурный ансамбль проспекта - уникальная коллекция стилей: модерн (Дом с башнями, Дом Трофимовых), неоклассицизм, конструктивизм (ДК Ленсовета), сталинский ампир. Зеленая улица с липами, ведущая к Каменному и Елагину островам. Центр культурной жизни (театры БДТ, Мюзик-Холл, ЛенДок).',
             'media': {'type': 'image', 'file': 'point29.png'}},

            {'name': 'территория Петропавловская крепость, 3И',
             'desc': 'Историческое ядро Санкт-Петербурга, крепость на Заячьем острове, заложенная Петром I в 1703 году. "3И" - это, скорее всего, обозначение конкретного корпуса или входа на территории крепости, используемое для внутренней навигации или адресации служебных помещений. Основное: Крепость - огромный музейный комплекс: Петропавловский собор (усыпальница Романовых) с золотым шпилем, тюрьма Трубецкого бастиона, Музей истории города, экспозиции в бастионах и куртинах, знаменитый полуденный выстрел пушки, песчаный пляж с видом на Дворцовую набережную.',
             'media': {'type': 'image', 'file': 'point30.png'}},

            {'name': 'Кронверкский мост',
             'desc': 'Небольшой пешеходный мост через Кронверкский пролив (канал), соединяющий Петроградскую сторону (Александровский парк) с Заячьим островом (Петропавловской крепостью). Построен в 1938 году на месте деревянного моста. Отсюда открываются классические виды на стены и бастионы крепости, а также на здание Арсенала (ныне Военно-исторический музей артиллерии) на противоположном берегу пролива.',
             'media': {'type': 'image', 'file': 'point31.png'}},

            {'name': 'Александровский парк',
             'desc': 'Парк, разбитый в 1845 году на месте гласиса (открытого пространства) Кронверка, между Кронверкским проливом и Кронверкским проспектом, напротив Петропавловской крепости. Имеет свободную планировку. Здесь расположены: Ленинградский зоопарк, Мюзик-Холл, Планетарий №1 (в здании старинного Газгольдера), памятник С. П. Королеву и Ю. А. Гагарину, Театр Балтийский дом. Популярное место прогулок с детьми и отдыха горожан.',
             'media': {'type': 'image', 'file': 'point32.png'}},

            {'name': 'муниципальный округ Кронверкское',
             'desc': 'Административно-территориальная единица (внутригородское муниципальное образование) в составе Петроградского района Санкт-Петербурга. Границы округа примерно охватывают территорию вокруг Петропавловской крепости, Александровского парка, зоопарка, части Каменноостровского проспекта и Кронверкского проспекта. Это исторический центр Петроградской стороны с высокой концентрацией памятников и культурных учреждений. "Кронверкское" - название округа, поэтому фото самого "округа" нет, есть фото его территории.',
             'media': {'type': 'image', 'file': 'point33.png'}},

            {'name': 'муниципальный округ Кронверкское',
             'desc': 'Административно-территориальная единица (внутригородское муниципальное образование) в составе Петроградского района Санкт-Петербурга. Границы округа примерно охватывают территорию вокруг Петропавловской крепости, Александровского парка, зоопарка, части Каменноостровского проспекта и Кронверкского проспекта. Это исторический центр Петроградской стороны с высокой концентрацией памятников и культурных учреждений. "Кронверкское" - название округа, поэтому фото самого "округа" нет, есть фото его территории.',
             'media': {'type': 'image', 'file': 'point34.png'}},

            {'name': 'Александровский парк, 6',
             'desc': 'Конкретный адрес на территории Александровского парка. По этому адресу расположено здание Санкт-Петербургского Мюзик-Холла - крупнейшего в городе театра музыкально-развлекательных представлений. Здание было построено в 1967 году и является ярким образцом советской архитектуры того периода. Это главное и самое узнаваемое строение по адресу Александровский парк, 6.',
             'media': {'type': 'image', 'file': 'point35.png'}}
        ]
    }
}


def get_media_path(filename):
    """Возвращает полный путь к медиафайлу"""
    if not filename:
        return None
    path = os.path.join(MEDIA_DIR, filename)
    print(f"[DEBUG] Проверка файла: {path}")
    return path if os.path.exists(path) else None


def send_media(chat_id, media_data, caption=None, markup=None):
    """Универсальная отправка медиа"""
    try:
        if not media_data or 'file' not in media_data:
            bot.send_message(chat_id, "🚫 Медиафайл не найден")
            return

        file_path = get_media_path(media_data['file'])
        if not file_path:
            bot.send_message(chat_id, "🚫 Файл не найден")
            return

        # Проверка размера файла
        file_size = os.path.getsize(file_path) / (1024 * 1024)  # в MB
        max_size = 50 if media_data['type'] == 'video' else 10

        if file_size > max_size:
            bot.send_message(chat_id, f"⚠️ Слишком большой файл ({file_size:.1f}MB)")
            return

        with open(file_path, 'rb') as file:
            if media_data['type'] == 'image':
                bot.send_photo(chat_id, file, caption=caption, reply_markup=markup)
            elif media_data['type'] == 'video':
                bot.send_video(chat_id, file, caption=caption, reply_markup=markup,
                               supports_streaming=True)
            else:
                bot.send_message(chat_id, "❌ Неподдерживаемый тип файла")

    except Exception as e:
        print(f"Ошибка отправки медиа: {e}")
        bot.send_message(chat_id, "⚠️ Ошибка загрузки медиафайла")


@bot.message_handler(commands=['start'])
def start(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    btn1 = types.KeyboardButton('Задать вопрос ❓')
    btn2 = types.KeyboardButton('Выбрать маршрут прогулки 🗺')
    markup.add(btn1, btn2)
    bot.send_message(message.chat.id, f'Привет, {message.from_user.first_name}! Я исторический бот 🤖',
                     reply_markup=markup)


def show_routes_menu(chat_id):
    markup = types.InlineKeyboardMarkup()
    markup.add(types.InlineKeyboardButton('Витебский вокзал', callback_data='route_vitebsk'))
    markup.add(types.InlineKeyboardButton('Финляндский вокзал', callback_data='route_finland'))
    bot.send_message(chat_id, 'Выберите начальную точку маршрута:', reply_markup=markup)


def send_route_confirmation(chat_id, route_key):
    route = routes.get(route_key)
    if not route:
        return

    markup = types.InlineKeyboardMarkup()
    markup.add(
        types.InlineKeyboardButton('Да, начинаем!', callback_data=f'confirm_{route_key}'),
        types.InlineKeyboardButton('Нет, выбрать другой', callback_data='cancel_route')
    )

    send_media(chat_id, route['media'], f'Маршрут от {route["name"]}', markup)



def send_next_point(chat_id, user_id):
    current_step = user_data[user_id]['step']
    route = routes[user_data[user_id]['route']]

    if current_step >= len(route['points']):
        bot.send_message(chat_id, '🎉 Вы завершили маршрут!')
        del user_data[user_id]
        return

    point = route['points'][current_step]
    markup = types.InlineKeyboardMarkup()
    markup.add(types.InlineKeyboardButton('Пройти дальше →', callback_data='next_point'))

    send_media(chat_id, point.get('media', {}), f'📍 {point["name"]}\n\n{point["desc"]}', markup)
    user_data[user_id]['step'] += 1


# Остальные обработчики остаются без изменений
@bot.callback_query_handler(func=lambda call: True)
def callback_handler(call):
    chat_id = call.message.chat.id
    user_id = call.from_user.id

    if call.data.startswith('route_'):
        route_key = call.data.split('_')[1]
        send_route_confirmation(chat_id, route_key)

    elif call.data.startswith('confirm_'):
        route_key = call.data.split('_')[1]
        user_data[user_id] = {'route': route_key, 'step': 0}
        send_next_point(chat_id, user_id)

    elif call.data == 'next_point':
        send_next_point(chat_id, user_id)

    elif call.data == 'cancel_route':
        show_routes_menu(chat_id)

    bot.answer_callback_query(call.id)


@bot.message_handler(content_types=['text'])
def text_handler(message):
    if message.text == 'Задать вопрос ❓':
        bot.send_message(message.chat.id, 'Напиши свой вопрос. Я попробую ответить 💡')

    elif message.text == 'Выбрать маршрут прогулки 🗺':
        show_routes_menu(message.chat.id)

    else:
        question = message.text.strip().lower()

        # Проверка на чувствительные темы
        if any(keyword in question for keyword in SENSITIVE_KEYWORDS):
            bot.reply_to(message, random.choice(NEUTRAL_RESPONSES))

        else:
            # Обработка через Yandex GPT
            try:
                sdk = YCloudML(folder_id="b1gvs7jjdg4qoj3r14qs", auth="AQVNxrkf2o6AkLosP8X0_ihulYjU9k5R2IOpoKmW")
                messages = [{"role": "system", "text": question}]
                completion = sdk.models.completions("yandexgpt").configure(temperature=0.5)
                result = completion.run(messages)

                if result and result.alternatives:
                    response = result.alternatives[0].text
                    # Дополнительная фильтрация ответов GPT
                    if "поиск" in response.lower() or "гугл" in response.lower():
                        bot.reply_to(message, "Этот вопрос лучше изучить по авторитетным источникам.")
                    else:
                        bot.reply_to(message, response)
                else:
                    bot.reply_to(message, "Не удалось найти информацию 😔")

            except Exception as e:
                print(f"Ошибка GPT: {e}")
                bot.reply_to(message, "Произошла ошибка при обработке запроса")

bot.polling(none_stop=True)